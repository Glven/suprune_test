import{j as e,c as v,B as w,r as u,o as z,d as $,I as O,t as N,e as B,f as b,u as q,O as K}from"./index-DkNblmKQ.js";const Q=({className:t})=>e.jsx("svg",{width:"20",height:"19",viewBox:"0 0 20 19",fill:"none",className:v({className:t}),xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18.3337 9.58329V12.1666C18.3337 14.0335 18.3337 14.9669 17.9703 15.6799C17.6508 16.3071 17.1408 16.8171 16.5136 17.1366C15.8006 17.5 14.8672 17.5 13.0003 17.5H7.00033C5.13348 17.5 4.20006 17.5 3.48702 17.1366C2.85982 16.8171 2.34988 16.3071 2.0303 15.6799C1.66699 14.9669 1.66699 14.0335 1.66699 12.1666V7.83329C1.66699 5.96645 1.66699 5.03303 2.0303 4.31999C2.34988 3.69278 2.85982 3.18285 3.48702 2.86327C4.20006 2.49996 5.13348 2.49996 7.00033 2.49996H10.417M15.8337 6.66663V1.66663M13.3337 4.16663H18.3337M13.3337 9.99996C13.3337 11.8409 11.8413 13.3333 10.0003 13.3333C8.15938 13.3333 6.66699 11.8409 6.66699 9.99996C6.66699 8.15901 8.15938 6.66663 10.0003 6.66663C11.8413 6.66663 13.3337 8.15901 13.3337 9.99996Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),H=({className:t})=>e.jsx("svg",{width:"15",height:"12",viewBox:"0 0 15 12",fill:"none",className:v({className:t}),xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M13.875 1.62537L5.125 10.375L0.75 6.00037",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),X=({className:t})=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",className:v({className:t}),xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M15.625 4.375L4.375 15.625",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M15.625 15.625L4.375 4.375",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),P=({className:t})=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",className:v({className:t}),xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M7.24112 16.875H3.75C3.58424 16.875 3.42527 16.8092 3.30806 16.692C3.19085 16.5748 3.125 16.4158 3.125 16.25V12.7589C3.125 12.6768 3.14117 12.5956 3.17258 12.5197C3.20398 12.4439 3.25002 12.375 3.30806 12.317L12.6831 2.94197C12.8003 2.82476 12.9592 2.75891 13.125 2.75891C13.2908 2.75891 13.4497 2.82476 13.5669 2.94197L17.0581 6.43309C17.1753 6.5503 17.2411 6.70927 17.2411 6.87503C17.2411 7.04079 17.1753 7.19976 17.0581 7.31697L7.68306 16.692C7.62502 16.75 7.55612 16.796 7.48029 16.8275C7.40447 16.8589 7.32319 16.875 7.24112 16.875Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10.625 5L15 9.375",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7.46011 16.8351L3.16479 12.5398",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),R=({className:t})=>e.jsx("svg",{width:"8",height:"14",viewBox:"0 0 8 14",fill:"none",className:v({className:t}),xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M7 1L1 7L7 13",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),T=({className:t})=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",className:v({className:t}),xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M16.8748 4.375L3.12476 4.37501",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M8.125 8.125V13.125",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.875 8.125V13.125",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M15.625 4.375V16.25C15.625 16.4158 15.5592 16.5747 15.4419 16.6919C15.3247 16.8092 15.1658 16.875 15 16.875H5C4.83424 16.875 4.67527 16.8092 4.55806 16.6919C4.44085 16.5747 4.375 16.4158 4.375 16.25V4.375",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M13.125 4.375V3.125C13.125 2.79348 12.9933 2.47554 12.7589 2.24112C12.5245 2.0067 12.2065 1.875 11.875 1.875H8.125C7.79348 1.875 7.47554 2.0067 7.24112 2.24112C7.0067 2.47554 6.875 2.79348 6.875 3.125V4.375",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),E={funeral_home:"Funeral Home",logistics_services:"Logistics services",burial_care_contractor:"Burial care Contractor"},A={"Sole Proprietorship":"Sole Proprietorship",Partnership:"Partnership","Limited Liability Company":"Limited Liability Company"},V=({handleClick:t})=>e.jsx(w,{type:"flutted",onClick:t,icon:e.jsx(P,{}),children:"Edit"}),W=({handleSave:t,handleCancel:a})=>e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx(w,{type:"flutted",icon:e.jsx(H,{}),onClick:t,children:"Save changes"}),e.jsx(w,{type:"flutted",onClick:a,icon:e.jsx(X,{}),children:"Cancel"})]}),ee="_modal_3boma_1",te="_modalActive_3boma_16",se="_modal__title_3boma_25",I={modal:ee,modalActive:te,modal__title:se},D=({isOpen:t,handleCancel:a,title:n,children:m,width:l})=>{const r=u.useRef(null);return u.useEffect(()=>{if(!t)return;const i=h=>{r.current&&!r.current.contains(h.target)&&a()},f=h=>{h.key==="Escape"&&a()};return document.addEventListener("mousedown",i),document.addEventListener("keydown",f),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("keydown",f)}},[t]),e.jsxs("div",{ref:r,className:v(I.modal,{[I.modalActive]:t}),style:{width:l||360},children:[n&&e.jsx("h2",{className:I.modal__title,children:n}),m]})},ne=({organizationId:t})=>{const[a,n]=u.useState(!1),[m,l]=u.useState(null),{addOrganizationPhoto:r}=M(),i=u.useRef(null),f=()=>{i.current&&(i.current.value="")},h=()=>{n(!1),l(null),f()},d=s=>{const p=s.target.files[0]||null;l(p)},o=()=>{if(!m){alert("Необходимо выбрать изображение");return}r(t,m),n(!1),l(null),f()};return e.jsxs("div",{children:[e.jsx(w,{type:"flutted",onClick:()=>n(!0),icon:e.jsx(Q,{}),children:"Add"}),e.jsxs(D,{isOpen:a,handleCancel:h,title:"Add Image",children:[e.jsx("input",{type:"file",onChange:d,accept:".jpg,.jpeg",ref:i}),e.jsxs("div",{style:{display:"flex",marginTop:"20px",gap:12},children:[e.jsx(w,{type:"outlined",onClick:h,children:"Cancel"}),e.jsx(w,{type:"filled",onClick:o,children:"Add photo"})]})]})]})},ae="_fields_1cjrv_1",le="_field_1cjrv_1",ie="_fieldTwoRows_1cjrv_13",oe="_field__label_1cjrv_16",ce="_field__value_1cjrv_21",re="_field__input_1cjrv_24",de="_photos_1cjrv_28",he="_photosItem_1cjrv_33",ue="_photosItem__btn_1cjrv_46",c={fields:ae,field:le,fieldTwoRows:ie,field__label:oe,field__value:ce,field__input:re,photos:de,photosItem:he,photosItem__btn:ue},me="_select_1rwmu_1",_e="_selectHead_1rwmu_4",pe="_selectHead__text_1rwmu_15",fe="_selectHead__icon_1rwmu_18",xe="_selectMenu_1rwmu_29",je="_selectMenu__item_1rwmu_42",ge="_selectMenu__itemCheckbox_1rwmu_52",Ce="_selectMenu__itemActive_1rwmu_71",ve="_selectActive_1rwmu_78",g={select:me,selectHead:_e,selectHead__text:pe,selectHead__icon:fe,selectMenu:xe,selectMenu__item:je,selectMenu__itemCheckbox:ge,selectMenu__itemActive:Ce,selectActive:ve},we=({options:t,handleSelect:a,initValue:n,placeholder:m})=>{const[l,r]=u.useState(!1),[i,f]=u.useState(n?{...n}:null),h=u.useRef(null),d=()=>r(s=>!s);u.useEffect(()=>{const s=p=>{h.current&&!h.current.contains(p.target)&&r(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const o=s=>{f(s),r(!1),a&&a(s)};return e.jsxs("div",{ref:h,className:v(g.select,{[g.selectActive]:l}),children:[e.jsxs("div",{className:g.selectHead,onClick:d,children:[e.jsx("p",{className:g.selectHead__text,children:(i==null?void 0:i.label)||m||"Select"}),e.jsx("p",{className:g.selectHead__icon,children:e.jsx(R,{})})]}),e.jsx("div",{className:g.selectMenu,children:t.map(s=>e.jsx("p",{className:v(g.selectMenu__item,{[g.selectMenu__itemActive]:s.value===(i==null?void 0:i.value)}),onClick:()=>o(s),children:s.label},s.value))})]})},ke=({options:t,handleSelect:a,initValues:n,placeholder:m})=>{const[l,r]=u.useState(!1),[i,f]=u.useState(n||[]),h=u.useRef(null),d=()=>r(s=>!s),o=s=>{f(p=>p.find(_=>s.value===_.value)?p.filter(_=>_.value!==s.value):[...p,s])};return u.useEffect(()=>{const s=p=>{h.current&&!h.current.contains(p.target)&&r(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]),u.useEffect(()=>{a&&a(i)},[i]),e.jsxs("div",{ref:h,className:v(g.select,{[g.selectActive]:l}),children:[e.jsxs("div",{className:g.selectHead,onClick:d,children:[e.jsx("p",{className:g.selectHead__text,children:i.map(s=>s.label).join(", ")||m||"Select"}),e.jsx("p",{className:g.selectHead__icon,children:e.jsx(R,{})})]}),e.jsx("div",{className:g.selectMenu,children:t.map(s=>e.jsxs("p",{className:v(g.selectMenu__item,{[g.selectMenu__itemActive]:i.some(p=>p.value===s.value)}),onClick:()=>o(s),children:[e.jsx("span",{className:g.selectMenu__itemCheckbox,children:e.jsx(H,{})}),e.jsx("span",{children:s.label})]},s.value))})]})},ye=z(({organization:t})=>{const{isEdit:a,handleClick:n,handleCancel:m,handleSave:l,handleContractNoChange:r,handleContactDateChange:i,swapped:f,typesString:h,newOrganization:d,newOrgDate:o,handleBusinessEntityChange:s,handleTypesChange:p}=Le(t),{contract:_,type:x,businessEntity:j}=d;return e.jsx($,{title:"Company details",button:a?e.jsx(W,{handleSave:l,handleCancel:m}):e.jsx(V,{handleClick:n}),children:e.jsxs("div",{className:c.fields,children:[a?e.jsxs("div",{className:v(c.field,c.fieldTwoRows),children:[e.jsx("p",{className:c.field__label,children:"Agreement:"}),e.jsx("div",{className:c.field__input,children:e.jsx(O,{handleChange:r,value:d.contract.no})}),e.jsx("p",{className:c.field__label,children:"Date:"}),e.jsx("div",{className:c.field__input,children:e.jsx(O,{type:"date",handleChange:i,value:o})})]}):e.jsxs("div",{className:c.field,children:[e.jsx("p",{className:c.field__label,children:"Agreement:"}),e.jsxs("p",{className:c.field__value,children:[_.no," / ",f]})]}),e.jsxs("div",{className:c.field,children:[e.jsx("p",{className:c.field__label,children:"Business entity:"}),a?e.jsx("div",{className:c.field__input,children:e.jsx(we,{options:Object.keys(A).map(C=>({value:C,label:A[C]})),placeholder:"Select business entity",initValue:{value:d.businessEntity,label:A[d.businessEntity]},handleSelect:s})}):e.jsx("p",{className:c.field__value,children:j})]}),e.jsxs("div",{className:c.field,children:[e.jsx("p",{className:c.field__label,children:"Company type:"}),a?e.jsx("div",{className:c.field__input,children:e.jsx(ke,{options:Object.keys(E).map(C=>({value:C,label:E[C]})),initValues:x.map(C=>({value:C,label:E[C]})),placeholder:"Select type of organization",handleSelect:p})}):e.jsx("p",{className:c.field__value,children:h})]})]})})}),He=u.memo(ye),Ne=z(({contact:t})=>{const{isEdit:a,handleNameChange:n,handleCancel:m,handleSave:l,handleClick:r,handleEmailChange:i,handlePhoneChange:f,newContact:h,formatPhone:d}=Se(t);return e.jsx($,{title:"Contacts",button:a?e.jsx(W,{handleSave:l,handleCancel:m}):e.jsx(V,{handleClick:r}),children:e.jsxs("div",{className:c.fields,children:[e.jsxs("div",{className:c.field,children:[e.jsx("p",{className:c.field__label,children:"Responsible person:"}),a?e.jsx("div",{className:c.field__input,children:e.jsx(O,{handleChange:n,value:`${h.firstname} ${h.lastname}`})}):e.jsxs("p",{className:c.field__value,children:[t==null?void 0:t.firstname," ",t==null?void 0:t.lastname]})]}),e.jsxs("div",{className:c.field,children:[e.jsx("p",{className:c.field__label,children:"Phone number:"}),a?e.jsx("div",{className:c.field__input,children:e.jsx(O,{handleChange:f,type:"phone",value:d(h.phone)})}):e.jsx("p",{className:c.field__value,children:d((t==null?void 0:t.phone)||"")})]}),e.jsxs("div",{className:c.field,children:[e.jsx("p",{className:c.field__label,children:"E-mail:"}),a?e.jsx("div",{className:c.field__input,children:e.jsx(O,{handleChange:i,value:h.email})}):e.jsx("p",{className:c.field__value,children:t==null?void 0:t.email})]})]})})}),Pe=u.memo(Ne),be=z(({organization:t})=>{const{photos:a}=t,{deleteOrganizationPhoto:n}=M(),m=l=>{n(t,N(l).name)};return e.jsx($,{title:"Photos",button:e.jsx(ne,{organizationId:t.id}),children:e.jsx("div",{className:c.photos,children:a.map(l=>e.jsxs("div",{className:c.photosItem,children:[e.jsx("img",{src:l.filepath,alt:l.name}),e.jsx("div",{className:c.photosItem__btn,children:e.jsx(w,{type:"filled-icon",icon:e.jsx(T,{}),onClick:()=>m(l)})})]},l.thumbpath))})})}),Re=u.memo(be),Le=t=>{const[a,n]=u.useState(!1),[m,l]=u.useState(N(t)),{contract:r,type:i,businessEntity:f}=m,{updateOrganizationData:h}=M();u.useEffect(()=>{l(N(t))},[t]);const d=()=>{n(!0)},o=()=>{h(m),n(!1)},s=()=>{l(t),n(!1)},[p,_,x]=new Date(r.issue_date).toLocaleDateString("ru-RU").split("."),j=`${_}.${p}.${x}`,C=k=>{l(y=>({...y,contract:{...y.contract,no:k}}))},Z=k=>{const y=new Date(k+"T00:00:00Z").toISOString();l(S=>({...S,contract:{...S.contract,issue_date:y}}))},F=i.map(k=>E[k]).join(", "),[G,U,Y]=new Date(m.contract.issue_date).toLocaleDateString("ru-RU").split("."),J=`${Y}-${U}-${G}`;return{newOrganization:m,newOrgDate:J,handleCancel:s,handleContractNoChange:C,handleContactDateChange:Z,handleSave:o,handleClick:d,isEdit:a,swapped:j,typesString:F,handleBusinessEntityChange:k=>{l(y=>({...y,businessEntity:k.label}))},handleTypesChange:k=>{l(y=>({...y,type:k.map(S=>S.value)}))}}},Oe=()=>{const[t,a]=u.useState(!1),{contactStore:n}=B(),m=async r=>{a(!0);try{const{data:i}=await b.get(`/contacts/${r}`);if(n.contact)return;n.setContact(i)}catch(i){console.error(i)}finally{a(!1)}},l=async r=>{const{lastname:i,firstname:f,id:h,email:d,phone:o}=r;try{const{data:s}=await b.patch(`/contacts/${h}`,{lastname:i,firstname:f,phone:o,email:d});if(!s)return;n.setContact({...n.contact,...s}),alert("Данные обновлены")}catch(s){console.error(s)}};return{contact:n.contact,fetchContact:m,isLoading:t,updateContactData:l}},Se=t=>{const[a,n]=u.useState(t?N(t):{createdAt:"",email:"",updatedAt:"",firstname:"",lastname:"",id:"",phone:""}),{updateContactData:m}=Oe();u.useEffect(()=>{n(N(t))},[t]);const[l,r]=u.useState(!1);return{handleCancel:()=>{r(!1),n(t)},handleClick:()=>{r(!0)},handleSave:()=>{m(a),r(!1)},newContact:a,handleNameChange:_=>{const x=_.lastIndexOf(" ");n(x===-1?j=>({...j,firstname:_,lastname:""}):j=>({...j,firstname:_.substring(0,x),lastname:_.substring(x+1)}))},handleEmailChange:_=>{n(x=>({...x,email:_}))},handlePhoneChange:_=>{const x=_.replace(/\D/g,"");n(j=>({...j,phone:x}))},isEdit:l,formatPhone:_=>{const j=_.replace(/\D/g,"").match(/^(\d{1})(\d{3})(\d{3})(\d{2})(\d{2})$/);return j?`+${j[1]} ${j[2]} ${j[3]}-${j[4]}-${j[5]}`:_}}},Ee="_buttons_lpf9s_1",ze="_buttons__edit_lpf9s_5",Me="_buttons__delete_lpf9s_11",Ae="_modalButtons_lpf9s_18",Ie="_modalText_lpf9s_24",L={buttons:Ee,buttons__edit:ze,buttons__delete:Me,modalButtons:Ae,modalText:Ie},Te=z(({organization:t})=>{const[a,n]=u.useState(!1),[m,l]=u.useState(!1),[r,i]=u.useState(N(t)),{updateOrganizationData:f,deleteOrganization:h}=M(),d=_=>{i(x=>({...x,name:_}))};u.useEffect(()=>{i(N(t))},[t]);const o=()=>{n(!1),l(!1)},s=()=>{f(r),o()},p=()=>{h(t.id),o()};return e.jsxs("div",{className:L.buttons,children:[e.jsx("button",{className:L.buttons__edit,onClick:()=>n(!0),children:e.jsx(P,{})}),e.jsx("button",{className:L.buttons__delete,onClick:()=>l(!0),children:e.jsx(T,{})}),e.jsxs(D,{title:"Specify the Organization's name",isOpen:a,handleCancel:o,children:[e.jsx(O,{handleChange:d,value:r.name}),e.jsxs("div",{className:L.modalButtons,children:[e.jsx(w,{type:"outlined",onClick:o,children:"Cancel"}),e.jsx(w,{type:"filled",onClick:s,children:"Save changes"})]})]}),e.jsxs(D,{isOpen:m,handleCancel:o,title:"Remove the Organization?",children:[e.jsx("p",{className:L.modalText,children:"Are you sure you want to remove this Organozation?"}),e.jsxs("div",{className:L.modalButtons,children:[e.jsx(w,{type:"outlined",onClick:o,children:"No"}),e.jsx(w,{type:"filled",onClick:p,children:"Yes, remove"})]})]})]})}),M=()=>{const{organizationStore:t}=B(),a=q(),[n,m]=u.useState(!1),l=async d=>{m(!0);try{const{data:o}=await b.get(`/companies/${d}`);if(!o)return;t.setOrganization(o)}catch(o){console.error(o)}finally{m(!1)}},r=async d=>{const{name:o,shortName:s,businessEntity:p,id:_,contract:x,type:j}=d;try{const{data:C}=await b.patch(`/companies/${_}`,{name:o,shortName:s,businessEntity:p,contract:x,type:j});if(!C)return;t.setOrganization({...t.organization,...C}),alert("Данные обновлены")}catch(C){console.error(C)}},i=async(d,o)=>{const{photos:s,id:p}=N(d);try{const{status:_}=await b.delete(`/companies/${p}/image/${o}`);if(_!==200)return;t.setOrganization({...d,photos:s.filter(x=>x.name!==o)}),alert(`Фотография ${o} успешно удалена`)}catch(_){console.error(_),alert("Ошибка удаления изображения")}},f=async(d,o)=>{try{const s=new FormData;s.append("file",o);const{data:p}=await b.post(`/companies/${d}/image`,s);if(!p)return;t.organization&&t.setOrganization({...t.organization,photos:[...t.organization.photos,p]})}catch(s){console.error(s),alert("Оишбка добавления изображения")}},h=async d=>{try{const{status:o}=await b.delete(`/companies/${d}`);if(o!==200)return;alert("Организация успешно удалена"),t.setOrganization(null),a(K)}catch(o){console.error(o),alert("Ошибка удаления организации")}};return{updateOrganizationData:r,organization:t.organization,fetchComp:l,isLoading:n,deleteOrganization:h,deleteOrganizationPhoto:i,addOrganizationPhoto:f}};export{R as L,Te as O,Oe as a,He as b,Pe as c,Re as d,M as u};
